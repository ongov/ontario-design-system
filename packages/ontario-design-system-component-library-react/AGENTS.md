# React Component Library - AI Agent Instructions

**Package**: `@ongov/ontario-design-system-component-library-react`

This package contains **auto-generated React wrappers** for Stencil components. Wrappers are generated by the component library build process. See [root AGENTS.md](../../AGENTS.md) for universal guidelines.

## Quick Reference

```bash
# Build
pnpm run build

# The source components are generated - don't edit directly!
# Edit the Stencil components in ontario-design-system-component-library instead
```

## How It Works

### Auto-Generation

React components are **automatically generated** from Stencil components during the component library build:

```typescript
// In packages/ontario-design-system-component-library/stencil.config.ts
reactOutputTarget({
	outDir: '../ontario-design-system-component-library-react/src/components',
	// ... other config
});
```

**Flow**:

1. Build component library: `cd packages/ontario-design-system-component-library && pnpm run build`
2. React components generated to `src/components/`
3. Build this package: `pnpm run build`
4. React apps can now import updated components

### What Gets Generated

- TypeScript React components
- Proper prop types and TypeScript definitions
- Event handlers with React naming (`onClick`, `onChange`, etc.)
- Ref forwarding
- TypeScript declarations

## Usage in React

### Basic Import

```typescript
import { OntarioButton } from '@ongov/ontario-design-system-component-library-react';

function App() {
  return (
    <OntarioButton
      variant="primary"
      onButtonClick={() => console.log('clicked')}
    >
      Click Me
    </OntarioButton>
  );
}
```

### Event Handling

Stencil events are automatically prefixed with `on`:

```typescript
// Stencil: @Event() buttonClick
// React:   onButtonClick

<OntarioButton
  onButtonClick={(event) => handleClick(event)}
/>

<OntarioInput
  onInputChange={(event) => setValue(event.detail)}
/>
```

### Props

All component props are typed and available:

```typescript
<OntarioButton
  variant="secondary"
  type="submit"
  htmlId="submit-btn"
>
  Submit
</OntarioButton>
```

### Refs

Components support ref forwarding:

```typescript
const buttonRef = useRef<HTMLOntarioButtonElement>(null);

<OntarioButton ref={buttonRef}>
  Click Me
</OntarioButton>
```

## SSR Considerations

### Hydration

For SSR (Server-Side Rendering) support, use the hydrate module:

```typescript
import { hydrateRoot } from 'react-dom/client';
import { renderToString } from '@ongov/ontario-design-system-component-library/hydrate';

// Server-side
const html = await renderToString(<App />);

// Client-side
hydrateRoot(document.getElementById('root'), <App />);
```

See [app-nextjs AGENTS.md](../app-nextjs/AGENTS.md) for Next.js-specific SSR patterns.

## Testing

### Unit Tests (React Testing Library)

```typescript
import { render, screen } from '@testing-library/react';
import { OntarioButton } from '@ongov/ontario-design-system-component-library-react';

test('renders button with text', () => {
  render(<OntarioButton>Click Me</OntarioButton>);
  expect(screen.getByText('Click Me')).toBeInTheDocument();
});
```

### Event Testing

```typescript
import { render, fireEvent } from '@testing-library/react';

test('calls onClick handler', () => {
  const handleClick = jest.fn();
  const { container } = render(
    <OntarioButton onButtonClick={handleClick}>
      Click Me
    </OntarioButton>
  );

  const button = container.querySelector('ontario-button');
  fireEvent.click(button);

  expect(handleClick).toHaveBeenCalled();
});
```

## Integration Testing

Integration tests are run in the `app-react` package. See [app-react AGENTS.md](../app-react/AGENTS.md).

## Build Process

### Dependencies

This package depends on:

- `@ongov/ontario-design-system-component-library` (peer dependency)

### Build Output

```bash
pnpm run build
```

**Outputs**:

- `dist/` - CommonJS and ESM modules
- Type declarations
- Package metadata

### Build Order

1. Component library generates React wrappers
2. This package builds the generated code
3. React apps can import the built package

## Development Workflow

### Making Changes

**Don't edit generated files directly!**

1. Edit Stencil component in `ontario-design-system-component-library`
2. Build component library to regenerate wrappers
3. Build this package
4. Test in `app-react` or `app-nextjs`

```bash
# Full workflow
cd packages/ontario-design-system-component-library
pnpm run build

cd ../ontario-design-system-component-library-react
pnpm run build

cd ../app-react
pnpm run start  # Test changes
```

### Quick Iteration

```bash
# From root - rebuild all libs
pnpm run build-libs

# Then restart React dev server
cd packages/app-react
pnpm run start
```

## Common Issues

### Components Not Updating

1. Ensure component library was rebuilt
2. Rebuild this package
3. Clear React app cache: `rm -rf packages/app-react/dist`
4. Restart dev server

### Type Errors

If TypeScript complains about component types:

1. Rebuild component library (regenerates types)
2. Rebuild this package
3. Restart TypeScript server in IDE

### Event Handlers Not Firing

Check event name mapping:

- Stencil: `@Event() buttonClick`
- React: `onButtonClick` (camelCase with 'on' prefix)

## Additional Resources

- [Stencil React Integration](https://stenciljs.com/docs/react)
- [Component Library AGENTS.md](../ontario-design-system-component-library/AGENTS.md)
- [App React AGENTS.md](../app-react/AGENTS.md)
- [App Next.js AGENTS.md](../app-nextjs/AGENTS.md)
- Component API docs: Generated READMEs in component library
